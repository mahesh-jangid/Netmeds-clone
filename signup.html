<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://code.iconify.design/2/2.1.0/iconify.min.js"></script>
    <link
      rel="shortcut icon"
      href="Images/icon.png"
      type="image/x-icon"
      sizes="16x16"
    />
    <link rel="stylesheet" href="Styles/navBar.css" />
    <link rel="stylesheet" href="Styles/signup.css" />
    <title></title>
  </head>
  <style>
  
  </style>
  <body>
    <div class="navbar"></div>

    <div id="mainSignUpCont">
      <div class="imageDiv">
        <img
          src="https://www.netmeds.com/images/cms/wysiwyg/cms/1588773798_sign-in-banner-new.png"
        />
      </div>
      <div class="form_page">
        <h1>Sign Up to <span class="diff">Netmeds</span></h1>
        <div class="erro_div">
          <p>User already exists &nbsp;<small>(Try with anthor one)</small></p>
          <span
            class="iconify hide_erro_msg"
            data-icon="gridicons:cross-small"
          ></span>
        </div>
        <form onsubmit="register(event)" class="form">
          <label>Name</label>
          <input type="text" id="name" placeholder="Enter Name" />
          <label>Email</label>
          <input type="email" id="email" placeholder="Enter Email" />
          <label>Username</label>
          <input type="text" id="username" placeholder="Enter Username" />
          <label>Password</label>
          <input type="password" id="password" placeholder="Enter Password" />
          <label>Mobile</label>
          <input type="number" id="mobile" placeholder="Enter Mobile" />
          <label>Desciption</label>
          <input
            type="text"
            id="description"
            placeholder="Enter  Description"
          />
          <input type="submit" value="Sign up" id="submit" />
        </form>

        <div class="new_acc">
          <p>Already have an Account?<a href="signIn.html">Login here</a></p>
        </div>
        <ul class="git_policy">
          <li><a href="#">Terms</a></li>
          <li><a href="#">Privacy</a></li>
          <li><a href="#">Security</a></li>
          <li>Contact Us</li>
        </ul>
      </div>
    </div>
  </body>
</html>
<script type="module">
  import navbar from "./components/navbar.js";

  let DOM_nav = document.querySelector(".navbar");
  DOM_nav.innerHTML = navbar();
</script>
<script src="Scripts/itemsInCart.js" type="module"></script>

<script>
  async function register(event) {
    try {
      event.preventDefault();
      var register_data = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        username: document.getElementById("username").value,
        password: document.getElementById("password").value,
        mobile: document.getElementById("mobile").value,
        description: document.getElementById("description").value,
      };

      checkvalidtion(register_data);
      register_data = JSON.stringify(register_data);
      console.log("register_data", register_data);
    } catch (err) {
      console.log(err);
    }

    let reg_api = `https://masai-api-mocker.herokuapp.com/auth/register`;
    let response = await fetch(reg_api, {
      method: "POST",
      body: register_data,
      headers: {
        "Content-Type": "application/json",
      },
    });

    let data = await response.json();
    console.log("data", data);
    if (!data.error) {
      window.location.href = "signIn.html";
    } else {
      var err = document.querySelector(".erro_div");
      var err_msg = document.querySelector(".erro_div > p");
      err_msg.innerHTML =
        "User already exists &nbsp;<small>(Try with anthor one)</small>";
      err.style.display = "flex";
      var msg = document.querySelector(".hide_erro_msg");
      msg.addEventListener("click", function () {
        err.style.display = "none";
      });
    }
  }

  function checkvalidtion(register_data) {
    if (
      register_data.name == "" ||
      register_data.email == "" ||
      register_data.username == "" ||
      register_data.password == "" ||
      register_data.mobile == "" ||
      register_data.description == ""
    ) {
      var err = document.querySelector(".erro_div");
      var err_msg = document.querySelector(".erro_div > p");
      err_msg.innerHTML = "Please fill all empty fields";
      err.style.display = "flex";
      var msg = document.querySelector(".hide_erro_msg");
      msg.addEventListener("click", function () {
        err.style.display = "none";
      });
    }
  }
</script>
